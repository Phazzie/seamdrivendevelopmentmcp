
> mcp-collaboration-server@1.0.0 test
> npx tsc -p tsconfig.json && node dist/scripts/verify-mandates.js && node --test dist/tests/unit/*.js dist/tests/contract/*.js dist/tests/integration/*.js

ğŸ” Scanning for Mandate Violations...
âœ… All Systems Compliant.
â–¶ MockAdrLog
  â–¶ ADR Log Contract
    âœ” should load fixture ADRs when present (1.705271ms)
    âœ” should create ADRs with default status (0.724112ms)
    âœ” should filter ADRs by status (0.586252ms)
  âœ” ADR Log Contract (4.01419ms)
  âœ” should fail when loading fault fixture (invalid_status) (1.320431ms)
âœ” MockAdrLog (6.055861ms)
â–¶ AdrAdapter
  â–¶ ADR Log Contract
    âœ” should load fixture ADRs when present (1.031715ms)
    âœ” should create ADRs with default status (2.589295ms)
    âœ” should filter ADRs by status (0.665368ms)
  âœ” ADR Log Contract (4.754201ms)
âœ” AdrAdapter (4.965881ms)
â–¶ MockAgentRegistry
  â–¶ Agent Identity Contract
    âœ” allows registering 'Claude' (1.907677ms)
    âœ” allows registering 'Gemini' (0.33005ms)
    âœ” rejects unknown agents (e.g. 'ChatGPT') (1.576584ms)
  âœ” Agent Identity Contract (4.794683ms)
âœ” MockAgentRegistry (5.316901ms)
â–¶ AgentAdapter (Real)
  â–¶ Agent Identity Contract
    âœ” allows registering 'Claude' (1.052108ms)
    âœ” allows registering 'Gemini' (1.052936ms)
    âœ” rejects unknown agents (e.g. 'ChatGPT') (0.998737ms)
  âœ” Agent Identity Contract (3.607592ms)
âœ” AgentAdapter (Real) (3.903482ms)
â–¶ MockAgentRegistry
  â–¶ Agent Registry Contract
    âœ” should register and resolve an agent (1.966287ms)
    âœ” should list agents (0.574673ms)
    âœ” should update lastSeenAt on touch (0.480873ms)
  âœ” Agent Registry Contract (3.930571ms)
  âœ” should fail when loading fault fixture (name_conflict) (0.922616ms)
âœ” MockAgentRegistry (5.593503ms)
â–¶ MockAgentRegistry
  â–¶ Agent Registry Contract
    âœ” should register and resolve an agent (2.168301ms)
    âœ” should list agents (0.544298ms)
    âœ” should update lastSeenAt on touch (0.598584ms)
  âœ” Agent Registry Contract (4.525998ms)
  âœ” should fail when loading fault fixture (name_conflict) (1.692669ms)
âœ” MockAgentRegistry (6.95925ms)
â–¶ Real AgentAdapter (with MockStore)
  â–¶ Agent Registry Contract
    âœ” should register and resolve an agent (1.113971ms)
    âœ” should list agents (4.770908ms)
    âœ” should update lastSeenAt on touch (1.311554ms)
  âœ” Agent Registry Contract (8.368647ms)
âœ” Real AgentAdapter (with MockStore) (8.574144ms)
â–¶ MockArbitration
  â–¶ Arbitration Contract
    âœ” should start idle (1.348408ms)
    âœ” should request, grant, and release the gavel (0.610347ms)
  âœ” Arbitration Contract (2.923289ms)
  âœ” should fail when loading fault fixture (no_gavel_active) (1.022976ms)
âœ” MockArbitration (4.596385ms)
â–¶ MockAuditLog
  â–¶ Audit Log Contract
    âœ” should record audit events (1.789268ms)
    âœ” should list audit events with filters (0.66045ms)
  âœ” Audit Log Contract (3.358576ms)
  âœ” should fail when loading fault fixture (read_denied) (3.266468ms)
âœ” MockAuditLog (7.280207ms)
â–¶ MockAuditLog
  â–¶ Audit Log Contract
    âœ” should record audit events (1.824433ms)
    âœ” should list audit events with filters (0.628463ms)
  âœ” Audit Log Contract (3.263259ms)
  âœ” should fail when loading fault fixture (read_denied) (0.898172ms)
âœ” MockAuditLog (4.815919ms)
â–¶ Real AuditAdapter (with MockStore)
  â–¶ Audit Log Contract
    âœ” should record audit events (0.986314ms)
    âœ” should list audit events with filters (0.609013ms)
  âœ” Audit Log Contract (2.038738ms)
âœ” Real AuditAdapter (with MockStore) (2.275125ms)
âœ” BuildPlan Contract - Basic (6.333095ms)
âœ” BuildPlan Contract - Adapter (0.676818ms)
âœ” Confidence Auction Contract - Mock (5.202388ms)
âœ” Confidence Auction Contract - Adapter (1.07815ms)
â–¶ MockDependencyManager
  â–¶ Dependency Manager Contract
    âœ” should load fixture dependencies (1.273131ms)
    âœ” should add and remove a dependency (0.382973ms)
  âœ” Dependency Manager Contract (2.563599ms)
  âœ” should fail when loading fault fixture (circular_dependency) (0.954973ms)
âœ” MockDependencyManager (4.121063ms)
â–¶ MockEventStream
  â–¶ Event Stream Contract
    âœ” should load fixture events when present (1.359331ms)
  âœ” Event Stream Contract (2.166004ms)
  âœ” should fail when loading fault fixture (stale_cursor) (0.888475ms)
âœ” MockEventStream (3.639154ms)
â–¶ MockIdeaRegistry
  â–¶ Idea Registry Contract
    âœ” should load fixture ideas when present (1.689101ms)
    âœ” should create an idea with default status (1.10786ms)
    âœ” should update an idea (0.765477ms)
    âœ” should list ideas including recent creates (0.566041ms)
    âœ” should get an idea by id (2.142733ms)
    âœ” should add notes to an idea (0.607804ms)
    âœ” should fail for unknown ideas (0.946729ms)
  âœ” Idea Registry Contract (9.111078ms)
âœ” MockIdeaRegistry (9.766708ms)
â–¶ MockIdeaRegistry
  â–¶ Idea Registry Contract
    âœ” should load fixture ideas when present (1.880827ms)
    âœ” should create an idea with default status (1.154151ms)
    âœ” should update an idea (1.304091ms)
    âœ” should list ideas including recent creates (3.369999ms)
    âœ” should get an idea by id (0.757629ms)
    âœ” should add notes to an idea (0.63574ms)
    âœ” should fail for unknown ideas (1.553019ms)
  âœ” Idea Registry Contract (11.8715ms)
âœ” MockIdeaRegistry (12.477982ms)
â–¶ Real IdeaAdapter (with MockStore)
  â–¶ Idea Registry Contract
    âœ” should load fixture ideas when present (2.175069ms)
    âœ” should create an idea with default status (1.083703ms)
    âœ” should update an idea (0.704581ms)
    âœ” should list ideas including recent creates (0.37012ms)
    âœ” should get an idea by id (0.400943ms)
    âœ” should add notes to an idea (0.506573ms)
    âœ” should fail for unknown ideas (0.334408ms)
  âœ” Idea Registry Contract (6.027962ms)
âœ” Real IdeaAdapter (with MockStore) (6.223ms)
â–¶ MockIntegrationSnapshotReader
  â–¶ Integration Snapshot Contract
    âœ” should return a valid snapshot (1.031053ms)
  âœ” Integration Snapshot Contract (1.887171ms)
  âœ” should fail on fault fixture (snapshot_failed) (0.939453ms)
âœ” MockIntegrationSnapshotReader (3.436209ms)
â–¶ MockIntegrationSnapshotReader
  â–¶ Integration Snapshot Contract
    âœ” should return a valid snapshot (1.909608ms)
  âœ” Integration Snapshot Contract (2.851566ms)
  âœ” should fail on fault fixture (snapshot_failed) (0.957375ms)
âœ” MockIntegrationSnapshotReader (4.454225ms)
â–¶ Real IntegrationSnapshotAdapter (with MockStore)
  â–¶ Integration Snapshot Contract
    âœ” should return a valid snapshot (1.600282ms)
  âœ” Integration Snapshot Contract (1.78873ms)
âœ” Real IntegrationSnapshotAdapter (with MockStore) (2.061685ms)
âœ” Knowledge Contract - Mock (1.908118ms)
âœ” Knowledge Contract - Adapter (2.431666ms)
â–¶ MockLocker Implementation
  â–¶ Locker Contract
    âœ” should acquire locks atomically (2.663049ms)
    âœ” should fail if any resource is locked by another (1.265534ms)
    âœ” should allow re-entrancy (same owner) (0.698612ms)
    âœ” should renew locks for owner (0.75408ms)
    âœ” should normalize resources based on fixture (0.813068ms)
    âœ” should ignore expired locks (0.458481ms)
  âœ” Locker Contract (10.762573ms)
  âœ” should fail when loading fault fixture (0.593788ms)
âœ” MockLocker Implementation (12.282376ms)
â–¶ MockLocker Implementation
  â–¶ Locker Contract
    âœ” should acquire locks atomically (1.778571ms)
    âœ” should fail if any resource is locked by another (1.33439ms)
    âœ” should allow re-entrancy (same owner) (0.651464ms)
    âœ” should renew locks for owner (1.47308ms)
    âœ” should normalize resources based on fixture (0.912781ms)
    âœ” should ignore expired locks (3.77347ms)
  âœ” Locker Contract (11.16959ms)
  âœ” should fail when loading fault fixture (1.863463ms)
âœ” MockLocker Implementation (13.772256ms)
â–¶ Real LockerAdapter (with MockStore)
  â–¶ Locker Contract
    âœ” should acquire locks atomically (1.4673ms)
    âœ” should fail if any resource is locked by another (0.630531ms)
    âœ” should allow re-entrancy (same owner) (0.315872ms)
    âœ” should renew locks for owner (0.461623ms)
    âœ” should normalize resources based on fixture (0.686079ms)
    âœ” should ignore expired locks (1.196004ms)
  âœ” Locker Contract (5.121588ms)
  âœ” should block acquisition when panic mode is enabled (0.350781ms)
  âœ” should block acquisition when a review gate is pending (0.454463ms)
âœ” Real LockerAdapter (with MockStore) (6.191886ms)
â–¶ MockMessageBridge
  â–¶ Message Bridge Contract
    âœ” should post and list messages (1.37089ms)
  âœ” Message Bridge Contract (2.245624ms)
  âœ” should fail when loading fault fixture (missing_author) (0.918137ms)
âœ” MockMessageBridge (3.917391ms)
â–¶ MockMessageBridge
  â–¶ Message Bridge Contract
    âœ” should post and list messages (1.423415ms)
  âœ” Message Bridge Contract (2.295879ms)
  âœ” should fail when loading fault fixture (missing_author) (0.930532ms)
âœ” MockMessageBridge (3.910622ms)
â–¶ Real MessageAdapter (with MockStore)
  â–¶ Message Bridge Contract
    âœ” should post and list messages (2.64104ms)
  âœ” Message Bridge Contract (2.895623ms)
âœ” Real MessageAdapter (with MockStore) (3.136738ms)
â–¶ MockMoodLog
  â–¶ Mood Log Contract
    âœ” should load fixture moods when present (1.424124ms)
    âœ” should log moods (0.557677ms)
  âœ” Mood Log Contract (6.901366ms)
  âœ” should fail when loading fault fixture (invalid_mood) (1.044869ms)
âœ” MockMoodLog (8.675401ms)
â–¶ MockNotificationCenter
  â–¶ Notification Center Contract
    âœ” should load fixture notifications when present (1.352459ms)
  âœ” Notification Center Contract (2.176133ms)
  âœ” should fail when loading fault fixture (invalid_priority) (0.916772ms)
âœ” MockNotificationCenter (3.718662ms)
âœ” PlanParser Contract - Basic (10.602031ms)
âœ” PlanParser Contract - Adapter (2.796012ms)
â–¶ Probe Runner Contract - Mock Verification
  âœ” should fail on fault fixture (compilation_error) (1.534638ms)
âœ” Probe Runner Contract - Mock Verification (2.555306ms)
â–¶ MockReviewGate
  â–¶ Review Gate Contract
    âœ” should submit, critique, and approve plans (2.279075ms)
  âœ” Review Gate Contract (3.125298ms)
  âœ” should fail when loading fault fixture (2.979217ms)
  âœ” should fail for lying agent scenario (0.559242ms)
âœ” MockReviewGate (7.502896ms)
â–¶ ReviewGateAdapter
  â–¶ Review Gate Contract
    âœ” should submit, critique, and approve plans (1.591126ms)
  âœ” Review Gate Contract (1.871127ms)
  âœ” should reject plan if IntentVerifier fails (0.602996ms)
  âœ” should reject plan when store resource is not acknowledged (1.344951ms)
âœ” ReviewGateAdapter (4.478959ms)
â–¶ MockScaffolder
  âœ” Scaffolder Contract - Valid Input (1.771015ms)
  âœ” Scaffolder Contract - Fault Injection (0.797443ms)
âœ” MockScaffolder (3.771915ms)
â–¶ MockScaffolder
  âœ” Scaffolder Contract - Valid Input (1.108975ms)
  âœ” Scaffolder Contract - Fault Injection (0.772125ms)
âœ” MockScaffolder (3.167598ms)
â–¶ Real ScaffolderAdapter
  âœ” Scaffolder Contract - Valid Input (29.260662ms)
âœ” Real ScaffolderAdapter (30.405989ms)
âœ” Scheduler Contract - Mock (8.061018ms)
âœ” Scheduler Contract - Adapter (1.503212ms)
â–¶ MockSddTracking
  â–¶ SddTracking Contract
    âœ” should satisfy contract scenarios (1.725913ms)
  âœ” SddTracking Contract (6.424025ms)
âœ” MockSddTracking (6.987571ms)
â–¶ SddTrackingAdapter
  â–¶ SddTracking Contract
    âœ” should satisfy contract scenarios (39.040128ms)
  âœ” SddTracking Contract (39.273438ms)
âœ” SddTrackingAdapter (39.447857ms)
â–¶ MockStatusReader
  â–¶ Status Snapshot Contract
    âœ” should return a status snapshot (4.359059ms)
  âœ” Status Snapshot Contract (5.26142ms)
  âœ” should fail when loading fault fixture (status_timeout) (0.95256ms)
âœ” MockStatusReader (7.434153ms)
â–¶ MockStatusReader
  â–¶ Status Snapshot Contract
    âœ” should return a status snapshot (1.565665ms)
  âœ” Status Snapshot Contract (2.43869ms)
  âœ” should fail when loading fault fixture (status_timeout) (0.977571ms)
âœ” MockStatusReader (4.098576ms)
â–¶ Real StatusAdapter (with MockStore)
  â–¶ Status Snapshot Contract
    âœ” should return a status snapshot (1.223837ms)
  âœ” Status Snapshot Contract (1.397194ms)
âœ” Real StatusAdapter (with MockStore) (1.631216ms)
â–¶ MockStore Implementation
  â–¶ Store Contract
    âœ” should load default state (1.797829ms)
    âœ” should atomic update successfully (0.579575ms)
    âœ” should pulse via waitForRevision on update (0.845516ms)
    âœ” should reject stale revision updates (1.083478ms)
  âœ” Store Contract (5.38698ms)
  âœ” should fail when loading fault fixture (0.637222ms)
âœ” MockStore Implementation (7.352434ms)
â–¶ MockStore Implementation
  â–¶ Store Contract
    âœ” should load default state (1.829623ms)
    âœ” should atomic update successfully (0.554326ms)
    âœ” should pulse via waitForRevision on update (0.74121ms)
    âœ” should reject stale revision updates (1.279029ms)
  âœ” Store Contract (5.727158ms)
  âœ” should fail when loading fault fixture (0.646878ms)
âœ” MockStore Implementation (10.106237ms)
â–¶ Real StoreAdapter Implementation
  â–¶ Store Contract
    âœ” should load default state (29.32428ms)
    âœ” should atomic update successfully (38.27161ms)
    âœ” should pulse via waitForRevision on update (47.877293ms)
    âœ” should reject stale revision updates (29.049893ms)
  âœ” Store Contract (145.103188ms)
  âœ” should create shard files on update (75.292957ms)
  âœ” should swap shard directory atomically (63.408386ms)
âœ” Real StoreAdapter Implementation (285.868489ms)
â–¶ MockTaskRegistry
  â–¶ Task Registry Contract
    âœ” should load fixture tasks when present (1.837017ms)
    âœ” should create a task with default status 'todo' (0.554905ms)
    âœ” should list tasks filtering by status (0.87317ms)
    âœ” should fail to update non-existent task (1.066858ms)
  âœ” Task Registry Contract (5.418604ms)
âœ” MockTaskRegistry (5.976028ms)
â–¶ MockTaskRegistry
  â–¶ Task Registry Contract
    âœ” should load fixture tasks when present (1.802532ms)
    âœ” should create a task with default status 'todo' (0.644773ms)
    âœ” should list tasks filtering by status (0.685359ms)
    âœ” should fail to update non-existent task (1.106507ms)
  âœ” Task Registry Contract (8.688797ms)
âœ” MockTaskRegistry (9.2319ms)
â–¶ Real TaskAdapter (with MockStore)
  â–¶ Task Registry Contract
    âœ” should load fixture tasks when present (1.933799ms)
    âœ” should create a task with default status 'todo' (3.342934ms)
    âœ” should list tasks filtering by status (0.815617ms)
    âœ” should fail to update non-existent task (0.387462ms)
  âœ” Task Registry Contract (6.962465ms)
âœ” Real TaskAdapter (with MockStore) (7.250976ms)
âœ” MockTelemetryClient - should yield log lines (1.361717ms)
âœ” MockTelemetryClient - should fail on fault fixture (0.924619ms)
â–¶ MockTestSeam
  âœ” exists (0.938556ms)
âœ” MockTestSeam (2.015342ms)
â–¶ MockTuiDataClient
  â–¶ TUI Data Client Contract
    âœ” loads chat history (0.902188ms)
    âœ” returns health snapshot (0.327289ms)
  âœ” TUI Data Client Contract (3.136017ms)
  âœ” loads named scenarios (0.226055ms)
âœ” MockTuiDataClient (4.022589ms)
â–¶ MockTuiDataClient
  â–¶ TUI Data Client Contract
    âœ” loads chat history (1.086393ms)
    âœ” returns health snapshot (0.342534ms)
  âœ” TUI Data Client Contract (2.395909ms)
  âœ” loads named scenarios (0.334773ms)
âœ” MockTuiDataClient (3.329679ms)
â–¶ Real TuiDataAdapter (with MockStore)
  â–¶ TUI Data Client Contract
    âœ” loads chat history (0.981354ms)
    âœ” returns health snapshot (0.734495ms)
  âœ” TUI Data Client Contract (1.937819ms)
âœ” Real TuiDataAdapter (with MockStore) (2.24387ms)
â–¶ MockWebCockpit
  âœ” exists (0.92785ms)
  âœ” should fail on port conflict fault (0.891506ms)
âœ” MockWebCockpit (3.174844ms)
â–¶ WebCockpitAdapter
  âœ” should reject when start cannot bind (13.884112ms)
âœ” WebCockpitAdapter (15.058125ms)
â–¶ Agent Identity Persistence
  âœ” should reuse existing agent ID when registering with same name (63.475192ms)
âœ” Agent Identity Persistence (64.905109ms)
â–¶ MCP External Store Fix Verification
  âœ” should allow Agent registration in an external whitelisted store (53.52118ms)
âœ” MCP External Store Fix Verification (56.394022ms)
â–¶ Store Persistence Integration
  âœ” should persist changes to disk immediately (53.337095ms)
âœ” Store Persistence Integration (54.597061ms)
â–¶ Store Persistence Integration
  âœ” should persist changes to disk immediately (58.866008ms)
âœ” Store Persistence Integration (60.039921ms)
âœ” Plan Tools - Round-Trip Verification (5.183444ms)
â–¶ Three-Agent Collaboration (Real Store)
  âœ” coordinates concurrent locks, contention, and communication (1012.713094ms)
  âœ” enforces panic freeze and recovers cleanly (306.284852ms)
âœ” Three-Agent Collaboration (Real Store) (1320.455094ms)
â–¶ Tool Registry Smoke (Wiring + Invocation)
  âœ” registers tools and invokes representative handlers across all providers (216.615129ms)
âœ” Tool Registry Smoke (Wiring + Invocation) (217.795063ms)
â–¶ JailedFs with External Roots
  âœ” should block external paths by default (1.443921ms)
  âœ” should allow external paths if whitelisted (8.71878ms)
  âœ” should allow exists check on whitelisted external paths (4.423539ms)
  âœ” should block sibling-prefix escape paths (1.048411ms)
  âœ” should block symlink escape writes (2.718481ms)
âœ” JailedFs with External Roots (19.778758ms)
â–¶ PathGuard with External Roots
  âœ” should block external paths by default (1.43339ms)
  âœ” should allow external paths if whitelisted (6.729386ms)
  âœ” should allow subdirectories of whitelisted external roots (1.506702ms)
  âœ” should block sibling-prefix escape paths (1.015831ms)
  âœ” should block symlink escape paths (1.805212ms)
âœ” PathGuard with External Roots (14.053429ms)
âœ” deriveViewModel - idle scenario (2.341507ms)
âœ” deriveViewModel - broadcast_waiting scenario (0.576858ms)
âœ” deriveViewModel - dual_pane_history scenario (0.391226ms)
âœ” deriveViewModel - leader_response scenario (0.470985ms)
âœ” deriveViewModel - stale_state scenario (0.404645ms)
âœ” deriveViewModel - panic_mode scenario (0.42837ms)
âœ” deriveViewModel - command_error scenario (0.473063ms)
â„¹ tests 194
â„¹ suites 101
â„¹ pass 194
â„¹ fail 0
â„¹ cancelled 0
â„¹ skipped 0
â„¹ todo 0
â„¹ duration_ms 4481.2762
