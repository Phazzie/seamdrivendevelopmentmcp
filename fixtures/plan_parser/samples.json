{
  "captured_at": "2026-01-08T02:05:50.794Z",
  "os": "darwin",
  "samples": {
    "master_plan": {
      "markdown": "# MCP Collaboration Server: Master Plan & Specification\n\n## 1. Project Overview\nA stateful Model Context Protocol (MCP) server designed to facilitate high-level collaboration, task delegation, and conflict avoidance between two distinct AI agents (Codex CLI and Gemini CLI) working on the same local codebase.\n\n### Core Technology Stack\n*   **Runtime:** Node.js (v18+)\n*   **Language:** TypeScript\n*   **Protocol:** Model Context Protocol (MCP) via STDIO\n*   **Persistence:** Local JSON Storage (`~/.mcp-collaboration/store.json`)\n*   **Validation:** Zod for tool input/output integrity\n\n---\n\n## 2. Architecture & Core Patterns\n\n### A. File Reservation System (Locking)\nTo prevent race conditions, agents must \"check out\" files before editing.\n*   **Mechanism:** `request_file_lock` and `release_file_lock`.\n*   **Validation:** The server rejects lock requests for files already held by the other agent.\n\n### B. Leader/Follower Workflow\nA structured state machine that forces planning and review before execution.\n*   **States:** `PROPOSED` → `DEBATING` → `REVISING` → `APPROVED` → `IN_PROGRESS` → `REVIEW_PENDING` → `COMPLETED`.\n*   **Roles:** Dynamic assignment of Leader (Executes) and Follower (Reviews/Critiques/Revises).\n*   **Protocol:** Plans must be critiqued by the Follower and optionally revised before Approval.\n\n### C. Panic Button (Circuit Breaker)\nA safety mechanism to freeze all operations in case of anomalies.\n*   **Triggers:** Manual user command or automated velocity detection (>X files modified in Y seconds).\n*   **Action:** Immediate global `403 Forbidden` on all file lock requests and state changes.\n\n---\n\n## 3. Implementation Status (Phased Plan)\n\n### Phase 1: The Foundation (SDD) - **COMPLETE**\n*   **Step 1.1: The Store Seam (Persistence):** Implements atomic `fs.rename` patterns and OCC.\n*   **Step 1.2: The Lock Manager Seam (Safety):** Implements `requestLocks`, `releaseLocks`, `renewLease`.\n\n### Phase 2: The Collaboration Features - **COMPLETE**\n*   **Step 2.1: The Task Registry:** Manage the \"ToDo\" list (`create_task`, `update_task`).\n*   **Step 2.2: The Message Bridge:** Real-time communication and long-polling (`wait_for_update`).\n\n### Phase 3: The Integration - **COMPLETE**\n*   **Server:** `src/index.ts` initializes all adapters and registers MCP tools.\n\n### Phase 4: The Meta-Tools (Self-Replication) - **PENDING**\n*   **Tool:** `scaffold_seam` - Automates the folder creation for future features.\n*   **Tool:** `run_probe` - Runs the probes and updates fixtures.\n\n### Phase 5: Mission Control \"Cockpit\" (TUI V2) - **COMPLETE**\n*   **Goal:** A dual-pane, chat-centric dashboard for real-time agent coordination.\n*   **Step 5.1: Seams & Contracts:** `tui.contract.ts` and `chat_simulation.ts` probe.\n*   **Step 5.2: The View Model:** Pure `deriveViewModel` logic with strict testing.\n*   **Step 5.3: The Adapter & UI:** `tui.adapter.ts` mapping to MCP tools, and `cockpit.ts` UI using `blessed`.\n\n---\n\n## 4. Future Roadmap: Advanced Suites\n\n### The \"Intelligence\" Suite\n*   **Shared Knowledge Graph:** A structured repository for persistent project-specific insights, jargon, and architectural quirks.\n*   **Decision Record (ADR):** Immutable logs explaining *why* a specific technical choice was made.\n*   **Glossary:** Registry for project-specific domain terms.\n\n### The \"Management\" Suite\n*   **Work Distribution Tool (`divvy_work`):**\n    *   **Goal:** Automatically split a large plan/task into sub-tasks.\n    *   **Function:** Assign specific sub-tasks to specific agents based on strengths/availability.\n    *   **Benefit:** Enables true parallel execution.\n\n### The \"Communication\" Suite\n*   **Discussion Channels:** Dedicated tools for brainstorming.\n*   **Real-Time Event Stream:** Allows agents to subscribe to specific events.\n*   **Priority Notifications:** Interrupts for urgent reviews.\n\n### The \"Meta-Cognition\" Suite\n*   **Confidence Auction:** Agents bid on tasks based on capabilities.\n*   **Mood/Confusion Log:** Tracking agent \"thrashing\" to trigger intervention.\n*   **Human Arbitration:** A specialized state that pauses automation until a human provides a \"Gavel\" decision.\n\n---\n\n## 5. Process & Protocols\n\n### Plan Peer Review\n*   **Mandate:**\n    1.  Agent A submits a plan.\n    2.  Agent B reads, critiques, and optionally revises the plan.\n    3.  Agents agree to \"Discuss Further\" or \"Approve & Implement\".\n\n### Seam-Driven Development (SDD)\n*   **Mandate:** No new feature without a Seam, Contract, Probe, Mock, and Test.\n*   **Pre-Flight Check:** Explicitly list Seam/Contract/Probe before starting work.\n"
    }
  }
}